<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Strategy Trainer - Reglas Corregidas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        h2 {
            color: #34495e;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 400;
            font-size: 1.3em;
        }

        .rules-btn {
            display: block;
            margin: 10px auto;
            padding: 10px 15px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .rules-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .rules-content {
            background: white;
            margin: 50px auto;
            padding: 20px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Cartas con colores seg√∫n palo */
        .cards-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .card {
            width: 80px;
            height: 120px;
            border: 3px solid #2c3e50;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            background: white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.spade { color: #2c3e50; } /* Negro */
        .card.heart { color: #e74c3c; } /* Rojo */
        .card.diamond { color: #3498db; } /* Azul */
        .card.club { color: #27ae60; } /* Verde */

        .card-value {
            font-size: 1.8em;
            line-height: 1;
        }

        .card-suit {
            font-size: 1.5em;
            margin-top: 5px;
        }

        /* Botones de acci√≥n con mismo color */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            filter: brightness(1.1);
        }

        /* Resultado */
        .result-section {
            margin-bottom: 25px;
            min-height: 80px;
        }

        .result-message {
            padding: 20px;
            border-radius: 12px;
            background: #f8f9fa;
            border-left: 5px solid #3498db;
            text-align: center;
        }

        .result-message.correct {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .result-message.incorrect {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        /* Bot√≥n nueva mano */
        .new-hand-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .new-hand-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        /* Estad√≠sticas */
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .card {
                width: 60px;
                height: 90px;
                font-size: 20px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¥ Poker Strategy Trainer</h1>
            <p>Practica tus decisiones en el flop</p>
            <button class="rules-btn" onclick="mostrarReglas()">üìã Ver Reglas</button>
        </header>

        <main class="practice-mode">
            <!-- FLOP -->
            <section class="flop-section">
                <h2>FLOP</h2>
                <div class="cards-container" id="flop-cards-visual">
                    <div class="card">-</div>
                    <div class="card">-</div>
                    <div class="card">-</div>
                </div>
            </section>

            <!-- MANO -->
            <section class="hand-section">
                <h2>MANO DEL BOT</h2>
                <div class="cards-container" id="hand-cards-visual">
                    <div class="card">-</div>
                    <div class="card">-</div>
                </div>
            </section>

            <!-- BOTONES DE ACCI√ìN -->
            <section class="action-buttons">
                <button class="action-btn check" onclick="verificarRespuesta('CHECK')">CHECK</button>
                <button class="action-btn bet-26" onclick="verificarRespuesta('BET_26')">BET 26%</button>
                <button class="action-btn bet-52" onclick="verificarRespuesta('BET_52')">BET 52%</button>
                <button class="action-btn bet-127" onclick="verificarRespuesta('BET_127')">BET 127%</button>
            </section>

            <!-- RESULTADO -->
            <section class="result-section">
                <div id="result-message" class="result-message">
                    <p>Selecciona la acci√≥n correcta para este flop y mano</p>
                </div>
            </section>

            <!-- NUEVA MANO -->
            <button id="new-hand-btn" class="new-hand-btn" onclick="nuevaMano()">üîÑ Nueva Mano Random</button>

            <!-- ESTAD√çSTICAS -->
            <div class="stats">
                <span>‚úÖ <span id="correct-count">0</span></span>
                <span>‚ùå <span id="incorrect-count">0</span></span>
                <span>üéØ <span id="accuracy">0%</span></span>
            </div>
        </main>
    </div>

    <!-- Modal de Reglas -->
    <div id="rules-modal" class="rules-modal">
        <div class="rules-content">
            <span class="close-btn" onclick="cerrarReglas()">&times;</span>
            <h2>Reglas del Poker Strategy Trainer</h2>
            
            <h3>1. CHECK (Pasar)</h3>
            <p>Se aplica cuando el flop cumple al menos una de estas condiciones:</p>
            <ul>
                <li><strong>Flop Coordinado Bajo:</strong> Todas las cartas ‚â§ 10 y diferencias ‚â§ 2 entre ellas</li>
                <li><strong>Flop Monocolor:</strong> Las 3 cartas del mismo palo</li>
                <li><strong>Flop Axx Bajo:</strong> Contiene un As y las otras dos cartas ‚â§ 5 (sin pares)</li>
            </ul>
            
            <h3>2. BET 52%</h3>
            <p>Se aplica cuando NO se cumple CHECK y el flop cumple al menos una de estas condiciones:</p>
            <ul>
                <li><strong>Dos Cartas Mismo Palo + Todas Altas:</strong> Dos cartas mismo palo, todas ‚â• 10, sin pares</li>
                <li><strong>Flop Tr√≠o:</strong> Las 3 cartas del mismo valor</li>
                <li><strong>Rainbow Seco Bajo:</strong> 3 palos diferentes, carta m√°s alta ‚â§ 9, sin pares, no coordinado</li>
            </ul>
            
            <h3>3. BET 127%</h3>
            <p>Se aplica cuando NO se cumple CHECK ni BET 52%, el flop cumple TODAS estas condiciones Y la mano es adecuada:</p>
            <p><strong>Condiciones del Flop:</strong></p>
            <ul>
                <li>Dos cartas altas (‚â• 10)</li>
                <li>Una carta baja (< 10)</li>
                <li>Proyecto de color (dos cartas del mismo palo)</li>
            </ul>
            <p><strong>Condiciones de la Mano (al menos una):</strong></p>
            <ul>
                <li>Top Pair con Kicker Premium</li>
                <li>Two Pair o mejor</li>
                <li>Proyectos de 4+ Outs (flush draw, OESD, gutshot)</li>
                <li>Bottom Pair + Carta del Proyecto</li>
                <li>Pocket Pair Bajo + Carta del Proyecto</li>
            </ul>
            
            <h3>4. BET 26%</h3>
            <p>Se aplica por defecto cuando NO se cumple CHECK, ni BET 52%, ni (BET 127% con mano v√°lida).</p>
        </div>
    </div>

    <script>
        // Configuraci√≥n
        const valores = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];
        const palos = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
        const valorNumMap = {'2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, 'T':10, 'J':11, 'Q':12, 'K':13, 'A':14};
        const paloClassMap = {'‚ô†': 'spade', '‚ô•': 'heart', '‚ô¶': 'diamond', '‚ô£': 'club'};

        // Estado global
        let flopActual = [];
        let manoActual = [];
        let accionCorrecta = '';
        let stats = { correctas: 0, incorrectas: 0 };

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            nuevaMano();
        });

        // Mostrar/ocultar reglas
        function mostrarReglas() {
            document.getElementById('rules-modal').style.display = 'block';
        }

        function cerrarReglas() {
            document.getElementById('rules-modal').style.display = 'none';
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('rules-modal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Generar nueva mano random
        function nuevaMano() {
            flopActual = generarCartasRandom(3);
            manoActual = generarCartasRandom(2);
            accionCorrecta = calcularAccionCorrecta();
            
            mostrarCartasVisuales();
            resetearResultado();
        }

        // Generar array de cartas random
        function generarCartasRandom(cantidad) {
            const cartas = [];
            for (let i = 0; i < cantidad; i++) {
                const valor = valores[Math.floor(Math.random() * valores.length)];
                const palo = palos[Math.floor(Math.random() * palos.length)];
                cartas.push({ valor, palo, valorNum: valorNumMap[valor] });
            }
            return cartas;
        }

        // Mostrar cartas en la interfaz
        function mostrarCartasVisuales() {
            // Flop
            const flopContainer = document.getElementById('flop-cards-visual');
            flopContainer.innerHTML = '';
            flopActual.forEach(carta => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${paloClassMap[carta.palo]}`;
                
                const valueElement = document.createElement('div');
                valueElement.className = 'card-value';
                valueElement.textContent = carta.valor;
                
                const suitElement = document.createElement('div');
                suitElement.className = 'card-suit';
                suitElement.textContent = carta.palo;
                
                cardElement.appendChild(valueElement);
                cardElement.appendChild(suitElement);
                flopContainer.appendChild(cardElement);
            });

            // Mano
            const handContainer = document.getElementById('hand-cards-visual');
            handContainer.innerHTML = '';
            manoActual.forEach(carta => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${paloClassMap[carta.palo]}`;
                
                const valueElement = document.createElement('div');
                valueElement.className = 'card-value';
                valueElement.textContent = carta.valor;
                
                const suitElement = document.createElement('div');
                suitElement.className = 'card-suit';
                suitElement.textContent = carta.palo;
                
                cardElement.appendChild(valueElement);
                cardElement.appendChild(suitElement);
                handContainer.appendChild(cardElement);
            });
        }

        // Calcular acci√≥n correcta seg√∫n reglas (VERSI√ìN CORREGIDA)
        function calcularAccionCorrecta() {
            // 1. Primero verificar CHECK (m√°xima prioridad)
            if (debeCheckear(flopActual)) {
                return 'CHECK';
            }
            
            // 2. Luego verificar BET 52%
            if (debeApostar52(flopActual)) {
                return 'BET_52';
            }
            
            // 3. Verificar BET 127% (solo si el flop cumple las condiciones)
            const flopCumple127 = debeApostar127Flop(flopActual);
            if (flopCumple127) {
                // Si el flop cumple, verificar si la mano es adecuada
                if (debeApostar127Mano(flopActual, manoActual)) {
                    return 'BET_127';
                }
            }
            
            // 4. Por defecto, BET 26% (cuando no aplican las reglas anteriores)
            return 'BET_26';
        }

        // Reglas para CHECK (CORREGIDAS)
        function debeCheckear(flop) {
            const valores = flop.map(c => c.valorNum);
            const palosFlop = flop.map(c => c.palo);
            
            // 1. Flop Coordinado Bajo: Todas ‚â§ 10 y diferencias ‚â§ 2
            const maxValor = Math.max(...valores);
            if (maxValor <= 10) {
                const sorted = [...valores].sort((a, b) => b - a);
                const diff1 = sorted[0] - sorted[1];
                const diff2 = sorted[1] - sorted[2];
                if (diff1 <= 2 && diff2 <= 2) {
                    return true;
                }
            }
            
            // 2. Flop Monocolor: 3 cartas mismo palo
            if (new Set(palosFlop).size === 1) {
                return true;
            }
            
            // 3. Flop Axx Bajo: Contiene A, otras dos ‚â§ 5, sin pares
            if (valores.includes(14)) {
                const otrasCartas = valores.filter(v => v !== 14);
                if (otrasCartas.every(v => v <= 5)) {
                    // Verificar que no haya pares
                    const valoresUnicos = new Set(valores);
                    if (valoresUnicos.size === 3) { // Sin pares
                        return true;
                    }
                }
            }
            
            return false;
        }

        // Reglas para BET 52% (CORREGIDAS)
        function debeApostar52(flop) {
            const valores = flop.map(c => c.valorNum);
            const palosFlop = flop.map(c => c.palo);
            
            // 1. Dos Cartas Mismo Palo + Todas Altas (sin pares)
            if (Math.min(...valores) >= 10) {
                const conteoPalos = {};
                palosFlop.forEach(p => conteoPalos[p] = (conteoPalos[p] || 0) + 1);
                if (Object.values(conteoPalos).includes(2)) {
                    // Verificar que no haya pares
                    const valoresUnicos = new Set(valores);
                    if (valoresUnicos.size === 3) {
                        return true;
                    }
                }
            }
            
            // 2. Flop Tr√≠o: 3 cartas mismo valor
            if (new Set(valores).size === 1) {
                return true;
            }
            
            // 3. Rainbow Seco Bajo: 3 palos diferentes, carta m√°s alta ‚â§ 9, sin pares, no coordinado
            if (new Set(palosFlop).size === 3) {
                const maxValor = Math.max(...valores);
                if (maxValor <= 9) {
                    // Verificar que no haya pares
                    const valoresUnicos = new Set(valores);
                    if (valoresUnicos.size === 3) {
                        // Verificar que no sea coordinado
                        const sorted = [...valores].sort((a, b) => b - a);
                        const diff1 = sorted[0] - sorted[1];
                        const diff2 = sorted[1] - sorted[2];
                        if (diff1 > 2 || diff2 > 2) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        // Verificar si el FLOP cumple condiciones para BET 127% (NUEVA FUNCI√ìN)
        function debeApostar127Flop(flop) {
            const valores = flop.map(c => c.valorNum);
            const palosFlop = flop.map(c => c.palo);
            
            // Debe tener dos cartas altas (‚â•10) y una baja (<10)
            const valoresAltos = valores.filter(v => v >= 10);
            const valoresBajos = valores.filter(v => v < 10);
            
            if (valoresAltos.length !== 2 || valoresBajos.length !== 1) {
                return false;
            }
            
            // Debe tener proyecto de color (dos cartas mismo palo)
            const conteoPalos = {};
            palosFlop.forEach(p => conteoPalos[p] = (conteoPalos[p] || 0) + 1);
            if (!Object.values(conteoPalos).includes(2)) {
                return false;
            }
            
            return true;
        }

        // Verificar si la MANO cumple condiciones para BET 127% (NUEVA FUNCI√ìN)
        function debeApostar127Mano(flop, mano) {
            const valoresFlop = flop.map(c => c.valorNum);
            const palosFlop = flop.map(c => c.palo);
            const valoresMano = mano.map(c => c.valorNum);
            const palosMano = mano.map(c => c.palo);
            
            // Encontrar el palo del proyecto (el que aparece dos veces en el flop)
            const conteoPalosFlop = {};
            palosFlop.forEach(p => conteoPalosFlop[p] = (conteoPalosFlop[p] || 0) + 1);
            let paloProyecto = null;
            for (const [palo, count] of Object.entries(conteoPalosFlop)) {
                if (count === 2) {
                    paloProyecto = palo;
                    break;
                }
            }
            
            // 1. Top Pair con Kicker Premium
            const maxValorFlop = Math.max(...valoresFlop);
            if (valoresMano.includes(maxValorFlop)) {
                // Verificar kicker premium seg√∫n la carta m√°s alta del flop
                if (maxValorFlop === 14 && (valoresMano.includes(13) || valoresMano.includes(12) || valoresMano.includes(11))) {
                    return true;
                } else if (maxValorFlop === 13 && (valoresMano.includes(14) || valoresMano.includes(12))) {
                    return true;
                } else if (maxValorFlop === 12 && (valoresMano.includes(14) || valoresMano.includes(13))) {
                    return true;
                } else if (maxValorFlop === 11 && (valoresMano.includes(14) || valoresMano.includes(13) || valoresMano.includes(12))) {
                    return true;
                } else if (maxValorFlop === 10 && (valoresMano.includes(14) || valoresMano.includes(13) || valoresMano.includes(12) || valoresMano.includes(11))) {
                    return true;
                }
            }
            
            // 2. Two Pair o mejor (simplificado)
            // Verificar si la mano forma two pair con el flop
            const valoresUnicosMano = new Set(valoresMano);
            if (valoresUnicosMano.size === 1) { // Pocket pair
                const pocketValor = valoresMano[0];
                if (valoresFlop.includes(pocketValor)) {
                    return true; // Forma tr√≠o
                }
            } else if (valoresUnicosMano.size === 2) { // Dos cartas diferentes
                // Verificar si cada carta hace par con el flop
                if (valoresFlop.includes(valoresMano[0]) && valoresFlop.includes(valoresMano[1])) {
                    return true; // Forma two pair
                }
            }
            
            // 3. Proyectos de 4+ Outs (simplificado)
            // Verificar flush draw (9 outs)
            if (paloProyecto && palosMano.includes(paloProyecto)) {
                return true;
            }
            
            // 4. Bottom Pair + Carta del Proyecto
            const minValorFlop = Math.min(...valoresFlop);
            if (valoresMano.includes(minValorFlop) && paloProyecto && palosMano.includes(paloProyecto)) {
                return true;
            }
            
            // 5. Pocket Pair Bajo + Carta del Proyecto
            if (valoresMano[0] === valoresMano[1] && valoresMano[0] < minValorFlop && paloProyecto && palosMano.includes(paloProyecto)) {
                return true;
            }
            
            return false;
        }

        // Verificar respuesta del usuario
        function verificarRespuesta(accionUsuario) {
            const resultMessage = document.getElementById('result-message');
            
            if (accionUsuario === accionCorrecta) {
                resultMessage.innerHTML = `<p>‚úÖ <strong>¬°Correcto!</strong> ${obtenerExplicacion()}</p>`;
                resultMessage.className = 'result-message correct';
                stats.correctas++;
            } else {
                resultMessage.innerHTML = `<p>‚ùå <strong>Incorrecto.</strong> La acci√≥n correcta era <strong>${accionCorrecta.replace('_', ' ')}</strong>. ${obtenerExplicacion()}</p>`;
                resultMessage.className = 'result-message incorrect';
                stats.incorrectas++;
            }
            
            actualizarEstadisticas();
        }

        // Obtener explicaci√≥n de la acci√≥n
        function obtenerExplicacion() {
            if (accionCorrecta === 'CHECK') {
                return 'Flop cumple reglas de check (coordinado bajo, monocolor o Axx bajo)';
            }
            if (accionCorrecta === 'BET_52') return 'Flop cumple reglas de bet 52% (dos cartas mismo palo + altas, tr√≠o o rainbow seco bajo)';
            if (accionCorrecta === 'BET_127') return 'Flop cumple reglas de bet 127% y la mano es adecuada';
            return 'No se cumplen otras reglas (apuesta por defecto 26%)';
        }

        // Resetear resultado
        function resetearResultado() {
            const resultMessage = document.getElementById('result-message');
            resultMessage.innerHTML = '<p>Selecciona la acci√≥n correcta para este flop y mano</p>';
            resultMessage.className = 'result-message';
        }

        // Actualizar estad√≠sticas
        function actualizarEstadisticas() {
            document.getElementById('correct-count').textContent = stats.correctas;
            document.getElementById('incorrect-count').textContent = stats.incorrectas;
            
            const total = stats.correctas + stats.incorrectas;
            const accuracy = total > 0 ? Math.round((stats.correctas / total) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }
    </script>
</body>
</html>
